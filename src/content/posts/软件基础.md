---
title: '软件基础：形式验证'
description: '一篇关于形式验证、Coq 安装和配置的入门指南，涵盖了 opam 和 VsCoq 的详细步骤。'
pubDate: 2025-07-30
tags: ['形式验证', 'Coq',  '教程', '环境配置']
author: 'Ating'
heroImage: 'software-found.webp'
ogImage: 'software-found.webp'
heroImageAspectRatio: '16/9'
recommend: true
---

形式验证是使用数学方法严格证明程序或系统正确性的技术。不同于测试（只能发现存在的错误），形式验证可以证明错误的不存在。

形式验证的目标是，将一段程序的功能用另一段程序表达，并且再用另一段程序来表示该程序符合给定的功能要求。

## Coq安装

Coq 提供了Linux、Windows和MacOS 在内的多系统安装。但是由于博主电脑问题或者其他一些原因，并没有成功安装其Windows环境，只能想办法在WSL2中，即Linux中使用COQ。
也幸亏之前有过WSL2+VsCode经验，不然又少不了一番折腾。

### 安装opam

Linux 和MacOs 可以使用 opam 官网提供的脚本一键安装。

```bash title='Shell Command'
bash -c "sh <(curl -fsSL https://opam.ocaml.org/install.sh)"
```

注意： 脚本会将 opam 默认安装到 `/usr/local/bin`，如不修改请确保当前用户该路径有读写权限`(sudo)`。

安装完成后可以使用下面命令确认是否安装成功。如果成功将返回 opam的版本号，为确保Coq 安装成功，请安装最新版 opam。

```bash title='Shell Command'
opam --version
```

安装成功后需要执行下面命令 初始化 opam 状态：

```bash title='Shell Command'
opam init
```

至此 opam 安装配置完成。

### 使用 opam 安装 Coq

本小节内容亦可访问 :link[官方安装指南]{id=https://coq.inria.fr/opam-using.html}。 

首先确保 opam 安装成功并初始化，接下来可以使用下面命令自动安装，由于 Coq 需要从源码编译所以安装时间较长：

```bash title='Shell Command'
opam pin add coq 8.20.0
```

注意：Coq 最新版本可能已更新，如果想查看最近版本请访问 :link[Coq官网]{id=https://coq.inria.fr/} 或者其 :link[github仓库]{id=https://github.com/coq/coq} 

以上述命令安装 Coq 不会自动更新，若更新请执行：

```bash title='Shell Command'
opam pin add coq <版本号>
```

使用下面命令可以查看 Coq 是否被正确安装：

```bash title='Shell Command'
coqc --version
```
<!-- :link[Coq官网]{id=https://coq.inria.fr/} 或者其 :link[github仓库]{id=https://github.com/coq/coq} -->
### 配置 VsCoq
首先在 vscode 中安装扩展 VsCoq。接下来按照 :link[插件说明页]{id=https://marketplace.visualstudio.com} 
的说明，依次运行两个下载命令：

```bash title='Shell Command'
opam pin add coq 8.18.0
opam install vscoq-language-server
```

这会在 ubuntu 上安装 language server，接下来为了让 vscode 找到这个 server，你需要运行

```bash title='Shell Command'
which vscoqtop
```

> [!caution]
> **注意**
>
> 如果此时没有输出（即失败），可能是没有刷新。运行
> ```bash title='Shell Command'
> eval $(opam env)
> ```

此时你将得到一个类似于
```bash title='Shell Command'
`/home/$USERNAME$/.opam/default/bin/vscoqtop`
```
的输出，将其**完整地复制下来**，填入 VsCoq 的 Extension Setting 中，`VsCoq: Path` 的值。

>有人在 Windows 下配环境变量配习惯了，把路径复制到 `../bin` 就停了。但是此时必须要完整地复制全部内容。

## 函数式编程
